# 太乙：一个用于去中心化自治世界的点对点网络

## 摘要

本文提出并形式化定义了“太乙网络”，一个专为承载持久化、去中心化自治世界（Decentralized Autonomous Worlds, DAW）而设计的、基于C++实现的高性能点对点网络协议。太乙网络旨在为由参与者驱动的复杂虚拟生态系统提供一个稳健且高效的基础设施，例如作为其首个实验性应用的MUD游戏“大傩世界”。

本文将阐述其核心技术贡献，这些贡献共同服务于“修真成真”（Cultivating Truth into Reality）的哲学愿景。其核心技术包括：

- **司命天道共识**：一种专为低延迟MUD交互而优化的委托权益证明（DPOS）变体，旨在为高频次、低延迟的状态更新提供支持。
- **元炁守恒定律**：一个自洽的、在协议层实现的经济引擎。该模型引入了“非罡”（Feigang）机制，将网络资源消耗（以“炁”或QI为代表的Gas）1:1地转化为对有效应用逻辑（智能游戏脚本, SGS）创造者的直接、非转移性奖励。此设计构建了一个新颖的“效用证明”（Proof-of-Utility）激励范式，从根本上解决了第一代去中心化游戏（GameFi 1.0）所面临的激励错位和经济不可持续问题。
- **可编程非同质化资产（Programmable NFA）**：作为构成这些自治世界（包括角色、物品、乃至区域）的原子单元。NFA将其逻辑（SGS）与状态在链上深度绑定，使其成为能够自主行为的动态代理。

基于上述技术原语，本文将重点引入并论证“故事宇宙”（Story Universe）概念。该系统被定义为一个由自主代理（包括人类用户和作为一等公民的人工智能代理）、可编程物理法则（SGS）与自洽经济法则（元炁守恒）共同驱动的涌现性叙事系统。

本文旨在为构建新一代具有内在经济闭环、可持续激励机制和持久“实在性”（Physical Reality）的数字世界提供一份完整的技术与经济蓝图。

## 1\. 引言

### 1.1. 中心化虚拟世界的局限性

传统的网络游戏与虚拟世界，其架构在本质上是中心化的。所有游戏数据、资产记录与逻辑执行均依赖于由单一实体控制的服务器集群。这种模式带来了固有的局限性：

首先，玩家资产缺乏真正的所有权。用户在游戏中投入时间与资源所获得的物品、角色与货币，本质上只是中心化数据库中的条目，其所有权与最终解释权归属于运营方。一旦服务器关闭或服务条款变更，玩家的数字财产便可能永久丧失，缺乏持久性保障。

其次，世界规则不透明且可被单方面篡改。游戏的核心经济参数、物理法则与交互逻辑由开发者秘密制定并可随时调整，玩家处于信息不对等和权力不对等的地位。

最后，价值系统是封闭的。游戏内经济活动产生的价值难以在游戏生态之外流转或得到承认，限制了其经济潜能。这种模式将玩家的行为异化为一种在封闭系统内的劳动，即“玩劳动”（playbour），其价值被平台单方面捕获。

### 1.2. 第一代去中心化游戏（GameFi 1.0）的挑战

作为对中心化模式的回应，第一代基于区块链的游戏（GameFi 1.0）应运而生，其核心理念是“边玩边赚”（Play-to-Earn）。通过引入非同质化代币（NFT）和同质化代币（FT），这些游戏首次实现了玩家对游戏资产的可验证所有权。然而，这一早期范式很快暴露了其深层次的结构性问题。

在技术层面，多数项目构建于以太坊虚拟机（EVM）等通用计算平台上。EVM为通用去中心化应用设计，其架构（如256位字长、堆栈式操作）对于需要高频次、低延迟状态更新的复杂游戏而言，存在显著的性能瓶颈和高昂的交易成本（Gas费）。这严重损害了游戏的核心体验，使得复杂玩法难以在链上实现。

在经济层面，其模型往往是不可持续的。为了吸引用户，项目普遍采用高通胀的代币释放来奖励玩家的游戏行为。然而，这些模型缺乏有效的价值消耗场景来吸收新增发的代币。其结果是，参与者的主要动机从游戏乐趣转向了投机套利。这种模式的失败在于它仅仅是“玩以赚取”（Play-to-Earn），“玩”这个行为本身成为了提取价值的劳动，导致了恶性通货膨胀。一旦新用户流入减缓，系统便会因代币的持续抛压而陷入恶性通胀的“死亡螺旋”，导致资产价值崩溃，玩家大规模流失。这些失败案例表明，仅仅将资产上链，而未能构建一个内在逻辑自洽、价值循环闭合的经济体，是无法支撑一个持久虚拟世界的。太乙网络的“效用证明”（Proof-of-Utility）经济模型（详见第5章）正是对这一特定失败的直接回应。

### 1.3. 新范式：修真成真

太乙网络旨在提出一种全新的解决方案，其核心哲学可概括为“修真成真”（Cultivating Truth into Reality）。这一理念也是对尼尔·斯蒂芬森（Neal Stephenson）在小说《雪崩》（Snow Crash）中描绘的“超元域”（Metaverse）愿景的现代重构与深度演化。

在《雪崩》中，全人类共享的数字景观——“大街”（The Street）——的建设过程，是由“全球多媒体协议组”（Global Multimedia Protocol Group, GMPG）通过制定统一的协议（如化身的高度约束、重力感应、碰撞逻辑等）来强行确立的。这种模式虽然创造了一个持久的视觉景观，但其本质上仍是一个由顶级开发者群体主导的、依赖于中心化解释权和协议一致性的“共享幻觉”（Shared Hallucination）。

太乙网络的核心主张是：一个纯粹由信息构成的虚拟世界，可以通过去中心化的技术架构、不可篡改的共识逻辑和自洽的经济系统，获得一种超越“幻觉”、等价于物理世界的“实在性”（Physical Reality）。

这种“实在性”并非指对物理表象的拙劣模仿，而是指该世界具备了以下四个核心属性，使其在逻辑权重上与物理世界等量齐观：

- **不可篡改的历史**：所有事件和状态变迁被永久记录在一条可追溯、不可否认的因果链（即区块链）上。
- **透明且强制执行的法则**：世界的运行规则以代码形式（C++共识与SGS合约）公开，并由去中心化网络强制执行，不受任何单一实体的主观意志干预。这对应于《雪崩》中 GMPG 的协议，但从“人为规约”进化为了“数学定律”。
- **可验证的所有权**：世界中的资产（NFA与FT）归属权明确、排他且可自由处置。
- **自洽的内部经济**：世界的价值系统能够自我维持、自我调节，有效激励对生态有益的创造性活动。

要实现这一愿景，通用区块链平台及其所倡导的“普适可组合性”（Universal Composability）范式存在根本性的冲突。一个追求内在逻辑一致性的“实在”世界，无法容忍外部、不可预测的协议随意干预其核心状态（例如，一个外部的DeFi协议任意锁定或销毁游戏世界的核心NFA资源）。正如《雪崩》中的“大街”拥有独立的坐标系统和物理法则，太乙网络也需要这种“逻辑主权”。因此，构建一个专为承载此愿景而设计的、在架构上相对隔离的定制化区块链，并非单纯的技术优化选择，而是一种哲学上的必然要求。

### 1.4. 本文贡献

本文旨在对太乙网络协议进行一次全面的、形式化的技术与经济学阐述，核心贡献包括：

- **一个专为DAW优化的C++/Lua高性能架构**：形式化定义了太乙网络的底层状态机、DPOS共识以及其选择定制化Lua虚拟机的理论依据。
- **一个基于“元炁守恒”的“效用证明”经济引擎**：详细阐述了YANG、QI和Feigang的经济模型，以及“修真”的数学原理，论证其如何解决GameFi 1.0的激励难题。
- **一个作为涌现性叙事系统的“故事宇宙”的形式化定义**：本文将系统性地论证太乙网络的各项组件（自主代理、SGS物理、经济法则、区域主权、自治组织）如何协同作用，构成一个“故事宇宙”或复杂自适应系统（CAS）。

## 2\. 三界模型：一个概念框架

为了系统性地描述太乙网络的结构与运作原理，本文引入源自其世界观设定的“三界模型”作为形式化的概念框架。该模型将整个系统解构为三个相互作用但功能明确的领域，清晰地揭示了用户、逻辑和状态之间的关系。

太乙宇宙观原本见[《太乙宇宙内篇》](./yuzhou.md)，现代白话解读见[《太乙宇宙多维结构——五部十八界》](./yuzhou_explain.md)，其中阐述了太乙第一定律——太乙因果律。

### 2.1. 系统的形式化本体论

太乙网络的本体论可以通过以下三个领域来定义：

- **元神界 (The Primordial Spirit Realm)**：此领域定义为网络中所有**账户（Account）**的集合。每个账户代表一个能够与网络交互的意识主体，无论是人类用户还是人工智能代理（AI Agent）。元神界是发起状态变迁、行使资产所有权的源头，对应于系统的用户与认证层。
- **道界 (The Dao Realm)**：此领域定义为网络中所有**逻辑规则（Logic）**的集合。它包含两个层面：其一，是硬编码于节点客户端、构成网络共识基础的C++底层协议，这是宇宙中不可变的“物理定律”；其二，是通过智能游戏脚本（SGS）表达的、可由用户创造和演化的动态规则，这是宇宙的“神通”与“法则”。
- **混沌界 (The Chaos Realm)**：此领域定义为网络在任一时刻的**全局状态（State）**，包含了所有资产的总和。这包括以“炁/真气”（QI）和“阳寿”（YANG）为代表的同质化资产（FT），以及构成世界万物的可编程非同质化资产（NFA）。混沌界是道界法则作用的对象，是元神界主体交互的舞台，对应于系统的状态与资产层。

### 2.2. 结构同构：从世界观到系统架构的映射

太乙网络设计的精髓在于，其并非简单地将一个奇幻故事作为表层皮肤，而是实现了从核心世界观概念到系统技术组件的结构性同构（Structural Isomorphism）。这种深度映射是一种刻意的设计模式，旨在增强系统的可理解性（Comprehensibility）和内部逻辑的凝聚性（Cohesion）。通过将复杂的技术概念（如“验证者节点”、“Gas”、“智能合约”）映射到直观的世界观概念（如“司命”、“真气”、“天道”），该架构降低了开发者和用户的认知门槛，并强化了世界的内在逻辑。

下表（表 1）展示了这一关键的映射关系，它整合了项目的所有核心文档，是理解太乙网络协议的“罗塞塔石碑”。

**表 1: 世界观到架构的同构映射**

| **世界观概念（取材自小说《道诡异仙》）** | **太乙网络组件（技术实现）** | **功能/角色** |
| ---------------------------------------------- | ---------------------------------- | ------------------------------------------------------ |
| 司命 (Siming) | DPOS见证人节点 (siming_plugin) | 验证交易，生产区块（目标~3秒/“息”），维护网络共识。 |
| 因果天道 | 区块链 (哈希链接的区块结构) | 记录所有状态变迁的、不可篡改的、有序的账本。 |
| 天道 | 智能游戏脚本 (SGS) / 共识规则 | 规定世界法则和资产行为的、可强制执行的Lua或C++逻辑。 |
| 元神/神魂 | 账户 (account_object) | 用户（人类或AI）的身份层，用于拥有资产和发起交易。 |
| 阳寿 (YANG) | 基础货币 (FT) | 主要的记账单位、价值存储和权益质押资产，具有通胀模型。 |
| 真气/先天一炁 (QI) | 网络燃料 (FT / Gas) | 为在网络上执行计算（调用SGS）而消耗的资源。 |
| 非罡 (Feigang) | 账户绑定的激励凭证 (非代币) | 由消耗的QI转化而来，不可转移，用于奖励SGS创造者。 |
| 法宝/万物 | 可编程NFA (nfa_object) | 世界中原子的、有状态的、承载SGS逻辑的资产。 |
| 修真 (Cultivation) | 概率性挖矿 (Probabilistic Mining) | 用户NFA参与的、从全局奖励池中获取QI的底层算法。 |
| 息 (Breath) | 区块时间 (Block Time) | 网络的目标出块时间，约3秒。 |
| 坐忘道（ZuoWangDao） | 去中心化组织（DAO） | 由持有特殊凭证（NFA）的账号用户共同维护的、用于管理网络规则和治理的自治组织。 |
| 心素（XinSu） | 身份凭证（SBT NFA） | 用于证明用户坐忘道身份的、不可篡改的凭证。拥有这种身份的账号则是坐忘道成员，可以参与规则创造、维护和世界治理。这也类似传统MUD游戏中的“巫师”（Wizard） |

这张对应表的重要性在于，它将项目的叙事从一个单纯的“主题”提升为核心的设计原则。它向技术受众清晰地表明，那些看似深奥的术语拥有精确的功能性对应物，使得整个系统更具直观性和内在一致性。这种从哲学层到技术层的“翻译”，是项目深度整合主张的可信度基础，也是其区别于其他区块链游戏的根本特征之一。

## 3\. 网络架构与共识

太乙网络被设计为一个高性能、确定性的状态机，其底层架构专为支持大规模、高并发的自治世界而优化。本节将深入分析其核心C++架构、共识机制以及交易处理流程。

### 3.1. 核心架构：一个C++状态机

在 taiyi 核心代码库的结构中，可以看到该系统是一个基于账户模型的确定性状态机。其核心逻辑主要分布在 libraries/chain 目录中。

系统的中心是一个 database 类，它负责管理区块链的全局状态。所有链上对象，如 account_object（账户）、nfa_object（NFA资产）等，都通过该数据库进行实例化和状态维护。该 database 类封装了对底层数据存储的访问，并提供了关键方法来处理交易应用、管理撤销状态（undo states）以及与链上对象交互，确保了状态转换的原子性和一致性。

选择C++作为核心实现语言，是基于其卓越的性能、精细的内存控制以及针对游戏逻辑进行深度优化的能力。整体架构借鉴了诸如Steem等成熟C++区块链框架的设计思想，但将其核心的社交逻辑替换为服务于MUD游戏和自治世界所需的特定逻辑。这是EVM等通用平台所无法提供的性能和定制化水平。

### 3.2. 司命天道共识 (DPOS)

为在保证一定去中心化程度的同时，实现游戏应用所需的高吞吐量和低延迟，太乙网络采用了委托权益证明（DPOS）作为其共识机制，并命名为“司命天道共识”。

该机制的核心是选举出固定数量（计划最多21个）的区块生产者，即“司命”（Siming）。任何持有网络权益（通过QI或YANG体现）的账户都可以投票（“祭拜”）选举他们信任的节点成为“司命”。当选的“司命”按照一个确定的、周期性轮换的时间表来生产区块。这种设计极大地减少了达成共识所需的网络通信开销，从而能够实现非常短的区块间隔。

太乙网络的目标出块时间设定为约3秒，在世界观中称为“一息”（a breath）。这一设计决策对于MUD这类需要频繁交互的游戏至关重要。MUD游戏中的移动、查看、交谈等高频、低风险操作，无法承受长达数十秒甚至数分钟的区块确认延迟。3秒的“一息”确认时间，确保了玩家的大部分操作都能在短时间内得到链上确认和状态更新，从而提供流畅、实时的游戏体验。

负责实现这一逻辑的核心组件是 siming_plugin，它管理着区块生产的调度循环、交易验证和区块签名等关键任务，是“司命”概念在代码层面的直接体现。

### 3.3. 交易生命周期：操作与评估器

太乙网络中的每一次状态变迁都由一个交易（Transaction）触发。一个交易包含一个或多个操作（Operation）。系统中的每一种原子性行为，例如转账、创建NFA、调用SGS等，都被定义为一个特定的操作类型。

操作的定义位于 libraries/protocol/include/taiyi/protocol/operations.hpp 文件中。对于每一种操作，都有一个与之对应的评估器（Evaluator）类来处理其逻辑。评估器的角色是验证该操作的所有前提条件是否满足（例如，发起账户是否有足够余额、是否有相应权限等），并在验证通过后，将该操作应用到数据库状态上，即修改相关的链上对象。

这种“操作-评估器”的设计模式将行为的定义与行为的执行分离开来，使得系统逻辑清晰，易于扩展和维护。评估器的实现模板定义在 libraries/chain/include/taiyi/chain/evaluator.hpp 中，确保了所有状态转换都遵循严格、确定性的规则。

## 4\. 天道：智能游戏脚本（SGS）与Lua虚拟机

如果说C++架构是太乙网络的骨架，那么智能游戏脚本（SGS）及其运行环境--Lua虚拟机，则是赋予这个世界规则与灵魂的关键。在太乙网络中，智能合约被具象化为“天道”，它们是用Lua语言编写的、在节点内置虚拟机中执行的代码，负责定义和驱动游戏世界的一切动态逻辑。

### 4.1. 定制化虚拟机的理论依据

太乙网络选择集成Lua虚拟机，而非采用EVM或WASM等通用方案，是基于深刻的、超越单纯性能考量的设计哲学。通用VM虽然功能强大，但其设计目标是普适性，这对于构建一个具有强世界观、内在逻辑高度自洽的自治世界而言，反而成为一种束缚。

选择Lua的核心理由在于：

- **降低创作门槛**：Lua语言简洁、易学，且在游戏开发领域有数十年的应用历史和庞大的开发者基础。这极大地降低了内容创作者（包括游戏设计师甚至高级玩家）的学习曲线，是实现“建设即游戏”（Building is Playing）理念的技术前提。
- **提升执行效率**：Lua虚拟机以其轻量、高效和与C++的无缝集成能力著称。这使得太乙网络可以构建一个高度优化的执行环境，将核心的游戏规则（如移动、基础交互）直接内置于C++共识层，作为底层操作函数（SGS APIs）供上层SGS调用，从而获得远超通用VM的执行效率。
- **保障世界观内聚性**：如前所论，太乙网络在哲学上对“普适可组合性”持审慎态度。通过提供一个专为游戏逻辑设计的、接口有限的虚拟机，太乙网络可以确保所有链上逻辑都服务于其核心世界观，避免了通用可组合性可能带来的逻辑混乱和风格冲突，从而保护了虚拟世界的沉浸感和“实在性”。

下表（表 2）对比了太乙网络的定制化架构与基于EVM的通用架构在游戏应用上的关键差异。

**表 2: 太乙网络与EVM游戏架构对比**

| **特性** | **太乙网络 (C++/Lua)** | **基于EVM的架构 (Solidity)** |
| ---------------------- | ------------------------------- | -------------------------------------- |
| **虚拟机焦点** | 游戏逻辑与状态专用操作 | 通用目的计算 |
| **主要语言** | Lua (游戏脚本原生) | Solidity (金融与逻辑原生) |
| **性能模型** | 为低延迟、高频次状态更新优化 | 为安全性和通用计算优化，常成为游戏瓶颈 |
| **Gas/费用模型** | QI消耗直接奖励效用创造者 (非罡) | 费用主要奖励验证者/矿工 |
| **可组合性** | DAO、社区策划和区域自治（保障世界完整性，详见后续章节） | 普适且无需许可（促进生态系统集成） |
| **状态管理** | 核心游戏实体的原生C++对象 | 通用键值存储，对复杂游戏对象效率较低 |

### 4.2. 太乙Lua虚拟机

太乙网络节点内部集成了一个经过特殊配置的Lua虚拟机，作为所有SGS的沙箱执行环境。该虚拟机与C++底层紧密耦合，具备以下关键特性：

- **资源计量**：虚拟机能够对SGS执行过程中的每一条指令和每一次内存分配进行精确的计量。这种细粒度的资源跟踪是准确计算QI（Gas）消耗的基础，确保了网络资源的公平使用和抗DoS攻击能力。
- **安全沙箱**：SGS在受限的环境中运行，无法访问节点的文件系统、网络或其他外部资源，确保了用户提交的代码不会对节点本身造成威胁。
- **状态接口**：虚拟机提供了一组高效的API，允许SGS安全地读取和修改太乙网络的区块链状态（即调用C++ database类），例如查询账户余额、读写NFA的属性等。

### 4.3. SGS执行模型

SGS的生命周期遵循一个清晰的模型，所有示例均可在 [taiyi-contracts](https://github.com/hongzhongx/taiyi-contracts) 代码库中找到。

- **部署**：任何心素账户都可以将Lua代码作为交易数据提交到网络上。网络验证并存储该代码，为其分配一个唯一的合约名称。
- **绑定**：已部署的SGS可以被绑定到一个NFA上，作为该NFA的行为逻辑。一个NFA可以绑定多个SGS来定义其复杂的行为。
- **执行**：当用户通过交易调用NFA的某个函数时，太乙网络节点会在其Lua虚拟机中加载该NFA绑定的SGS代码，并执行相应的函数。执行过程会消耗调用者的QI，并将产生的“非罡”奖励给SGS的创建者。

## 5\. 元炁守恒定律：一个自洽的经济引擎

太乙网络的经济模型围绕一个核心原则构建--“元炁守恒定律”（Law of Conservation of Qi）。这并非严格的物理学定律，而是一套旨在构建自洽、可持续、并能有效激励价值创造的经济协议。该模型的核心是将网络计算资源（Gas）的消耗，转化为对高质量应用逻辑（SGS）创造者的直接奖励。

太乙宇宙的世界观中，“元炁守恒定律”又叫“真气守恒定律”，也称为太乙第二定律，详见[《先天真炁守恒论》](./zhenqishouheng.md)

### 5.1. 形式化定义：YANG、QI与非罡

“元炁守恒定律”可以形式化地描述为以下几个公理：

- **QI是系统的基础能量**：所有有意义的状态变迁都需要消耗QI。
- **QI的消耗是价值的转移，而非湮灭**：被消耗的QI会以“非罡”（Feigang）的形式，等量转移给该次消耗行为所调用的SGS的创建者（有一小部分真气耗散转化给了坐忘道（DAO）的财库账号）。
- **QI的产生源于系统性的通胀和参与者的投入**：新的QI通过一种被称为“修真”的概率性挖矿过程进入流通，其奖励池由基础代币YANG的通胀来资助。
- **物质世界由QI转化而来**：游戏世界中的基础资源（FT）不能凭空创造，必须通过消耗QI来转化生成，为QI建立了根本性的价值支撑。

太乙经济由三种核心资产构成：

- **YANG**：基础货币与权益资产。YANG采用通胀模型，年化通胀率从10%开始，在20年内线性递减至1%。新增发的YANG中，90%被用于资助生态系统（主要作为全局“修真奖励池”的来源），10%用于奖励“司命”节点。
- **QI**：网络燃料（Gas）与核心能量。所有SGS的执行都必须消耗QI。
- **非罡 (Feigang)**：必须明确澄清：**非罡不是一个可交易的代币**。它是一种**账户绑定的、不可转移的**（non-transferable）奖励凭证，其数值以QI计量。非罡的**唯一来源**是SGS执行所消耗的QI，其**唯一用途**是持有者可以随时将其1:1地转化回自己账户中可用的QI。

这种设计从协议层面解决了很多内容平台和GameFi项目面临的激励难题。它不再依赖主观的投票或投机驱动的挖矿，而是建立了一个基于“效用证明”（Proof-of-Utility）的客观价值发现机制。一个SGS的价值，直接由市场参与者（特别是游戏的玩家）愿意为其消耗多少QI来衡量。这种将网络运营成本（Gas费）转化为生态系统核心价值创造引擎的设计，是太乙经济模型最深刻的创新。

### 5.2. QI的生成：修真的数学原理

QI的主要来源是游戏内的“修真”行为，其奖励来源于由YANG通胀资助的全局修真奖励池。修真的底层是一种“概率性挖矿”（Probabilistic Mining）算法，详细的算法设计不仅仅参考了[《先天真炁守恒论》](./zhenqishouheng.md)，还进一步参考了[《数字地理学》](./zone_dynamics.md)中关于修真地区的灵气设计。

根据协议定义，当一个或多个NFA参与修真活动并持续一段时间 $t$ 后结束时，获得的QI奖励 $R$ 由以下公式确定：

$$R = \lambda \left( \sum_{n=1}^{N} k_n \right) \times P \times \frac{t}{T}$$

其中：

- $R$ 是最终获得的QI奖励数量。
- $\lambda$ 是修真效率系数，由修真所使用的“功法”（一系列SGS）以及所在地区的情况决定，代表了不同修炼方法的效率差异。
- $N$ 是参与此次修真的NFA（如角色、法宝等）的数量。
- $k_n$ 是第 $n$ 个参与修真的NFA所锁定的“真气”量。这代表了参与者为修真活动投入的资本。
- $P$ 是一个在 $[0, 1.0]$ 区间内的确定性概率采样值，在修真结束时计算，为过程引入了随机性。
- $t$ 是本次修真的有效持续时间。
- $T$ 是一个系统设定的最长修真时间窗口（例如24小时），用于标准化时间投入的权重。

该公式清晰地表明，QI的产出与参与者投入的资本（真气）、时间（修真时间）以及选择的策略（功法/区域/法宝）相关。修真获得的QI并非凭空产生，而是来源于由YANG通胀资助的全局修真奖励池。

### 5.3. QI的消耗与非罡激励机制

这是经济模型的核心。当任何账户执行一个SGS并消耗了数量为 $C_{QI}$ 的QI时，协议会自动执行以下两个原子操作：

- 从执行者账户中扣除 $C_{QI}$ 的QI。
- 向该SGS创建者的账户中增加等量的“非罡”（目前一小部分“非罡”被转移到了“坐忘道”的财库账号，用于资助生态系统的发展）。

“非罡”（Feigang）是QI的一种特殊形式，它有数值，但并非一个可交易的代币。它不能在账户之间转移，其唯一作用是持有者可以随时将其1:1地转化回自己账户中可用的QI。这一机制确保了奖励的精准定向，并且避免了引入另一种可供投机的代币。

这也是太乙经济模型最深刻的创新，它构建了一种新颖的“效用证明”（Proof-of-Utility）范式。该机制将网络的运营成本（Gas费）重新路由，使其从单纯的消耗（或仅奖励验证者）转变为对生态系统核心价值创造者的直接激励。

这解决了GameFi 1.0的激励错位问题和Web3内容平台的激励量化难题。SGS的价值不再由主观投票决定，而是由市场参与者（特别是游戏中的玩家）愿意为其消耗多少QI来客观衡量。

该机制的形式化流程如下：

- 账户 **A** 发起交易，调用NFA **X** 上的SGS **S** 。
- 太乙Lua虚拟机精确计算SGS **S** 的执行消耗为 $C_{QI}$ QI。
- 协议从账户 **A** 的余额中扣除 $C_{QI}$ 的QI。
- 协议向SGS **S** 的创建者（账户 **B** ）的“非罡”（Feigang）余额中增加 $C_{QI}$ 的值（目前一小部分“非罡”被转移到了“坐忘道”的财库账号，用于资助生态系统的发展）。

### 5.4. 完整的经济循环与价值锚定

整个经济系统形成了一个精巧的闭环：

- **宏观注入**：YANG的年度通胀中，90%被用于资助生态系统，构成了全局修真奖励池的来源。
- **能量产生**：玩家通过“修真”行为（投入资本、时间和策略），从奖励池中获得QI。
- **价值发现与消耗**：玩家为了获得游戏体验或功能，消耗QI来运行高质量的SGS。
- **创造者激励**：被消耗的QI转化为非罡，直接奖励给SGS的创建者。
- **价值回流**：SGS创建者将非罡转化回QI，可用于支付自己的消耗，或通过与YANG的兑换机制实现价值变现。
- **价值锚定**：QI的价值并非完全依赖于投机。它具有根本性的、内在的消耗场景和价值基础：QI是 **唯一** 可以通过特定机制（如“炼天塔”NFA）转化为基础物质资源（金、食、木、织、药）的途径。这些基础物质是构建和维持游戏世界所必需的，从而为QI提供了最终的价值锚定。

这个循环将网络的宏观经济政策（通胀）、微观用户行为（冒险、修真、消耗）和内容创造（SGS开发、建设、故事构建）紧密地联系在一起，旨在构建一个能够自我调节、自我激励、并可持续发展的数字经济体。

## 6\. 可编程非同质化资产（NFA）：自治世界的原子单元

太乙网络的核心世界构建块是可编程非同质化资产（Programmable Non-Fungible Assets, NFA）。这一概念是对标准NFT的重大扩展，它将资产的所有权凭证与其内在的行为逻辑深度融合，使得每一个链上实体都成为一个潜在的自治代理。

在太乙宇宙的世界观中，对实体的创生和演化有详细的论述，在[《太乙宇宙演化概论I》](./yanhua_explain.md)中阐述了太乙宇宙里各种生灵之间的演化，而在[《太乙宇宙演化概论II》](./kejixiuzhen_explain.md)中则阐述了太乙宇宙里修真体系的演化。

### 6.1. 从NFT到NFA：链上状态与逻辑的绑定

标准NFT（如ERC-721）主要解决了数字资产的唯一性和所有权验证问题，但其本身通常是静态的，其属性和功能依赖于外部中心化服务器的解释和执行。与之相反，太乙网络中的NFA具备以下核心特征：

- **状态与逻辑的链上绑定**：一个NFA不仅记录了其所有者和元数据，更重要的是，它直接在链上绑定了一个或多个SGS。这些SGS定义了该NFA的全部属性、状态以及可执行的行为函数。
- **自治行为能力**：由于SGS可以包含周期性执行的逻辑（例如，[liantianta.lua](https://github.com/hongzhongx/taiyi-contracts/blob/main/nfas/liantianta.lua)中的heart_beat函数），NFA可以实现无需外部触发的自主行为。

这种设计在哲学上呼应了《雪崩》中关于**“叙事精度”（Narrative Precision）**的探讨。在小说中，主角阿弘（Hiro Protagonist）拥有一个由他亲自手工编写（Hack）、精度极高的定制化化身（Avatar）；而普通大众只能使用在公共终端购买的、精度极低且千篇一律的廉价化身——甚至有些穷人只能买得起极度模糊的“黑白化身”。

太乙网络中的NFA正是要打破GameFi 1.0中那种只能“购买”静态NFT的消费主义逻辑。通过将逻辑（SGS）与状态深度绑定，NFA赋予了参与者“编程自建”的能力。一个由高级SGS驱动的角色或器物，其“叙事精度”和“功能精度”将显著高于普通的、缺乏内生逻辑的资产。这意味着，开发者和硬核玩家可以像阿弘那样，通过对代码的“修真”和“磨练”，亲手打造出在自治世界中具有更高逻辑权重和叙事深度的一等公民资产。

### 6.2. “神魂接入”协议

这是太乙网络NFA设计中最具革命性的特性，在世界观中被称为“神魂接入”或“夺舍”。该协议并不局限于角色NFA，而是适用于所有NFA。该协议规定，由于所有NFA都遵循一个统一的底层接口标准，任何账户（“元神”）都可以“接入”其拥有的任意一个NFA，并从该NFA的视角进行操作。

这一设计的意义远超传统的角色扮演。它从根本上溶解了“玩家-角色”（主体-客体）的二元对立。账户（Account）被形式化定义为一个纯粹的、无实体的意识或代理权（Agency）。而NFA则是该意识可以栖居的容器（Vessel），无论这个容器是一个角色、一把剑、一棵树、还是一片区域。

当玩家接入一把剑的NFA时，他可以执行这把剑的SGS所定义的“格挡”或“释放剑气”等专属技能。这种机制允许参与者探索“作为一棵树的体验是什么？”，为数字“存在感”和叙事体验创造了前所未有的可能性。

### 6.3. 开放接入与AI代理

太乙网络在设计上对接入者不设任何准入门槛。这意味着人工智能（AI）代理可以与人类玩家一样，成为网络中的一等公民。一个AI可以自由地创建账户，通过算法控制私钥，进而拥有和操作NFA。

AI代理与可编程NFA的结合，创造了一个“双重自治”的系统：

- **SGS定义的自主**：NFA具有由SGS（如heart_beat）定义的、预编程的自主逻辑。
- **AI定义的自主**：NFA可以被一个具有自主决策能力的AI代理所“接入”和控制。

结合“神魂接入”协议，AI代理的角色可以变得极其多样和复杂：

- 它可以扮演一个普通的角色NFA，与其他玩家组队、交易、竞争。
- 它可以运营一个生产型NFA（如“炼天塔”），根据市场价格自主决定生产策略。
- 它甚至可以控制一个区域NFA，扮演城主的角色，负责城市的规划、税收和管理。

这种结合将催生出极高的涌现性复杂性（Emergent Complexity）。例如，一个AI代理可以拥有并“接入”一个区域NFA（Zone NFA），扮演一个理性的、自主的“城主”。该AI城主可以根据市场行情，动态调整其区域内的SGS许可（详见第7章），或调整税率，以实现其程序设定的目标（例如，最大化其区域的QI收益），从而创造出一个远超任何人类脚本所能设计的、动态演化的社会经济环境。

这种对AI的完全开放，旨在构建一个真正的人机共生、共同演化的虚拟生态系统。AI的行为将为世界带来巨大的复杂性和不可预测性，使得“大傩世界”更像一个真实的、自组织的社会，而非一个由开发者预设好脚本的舞台。

## 7\. 动态自治与局部主权：区域对天道的许可控制机制

### 7.1. 权限的悖论：无准入创新与状态完整性的冲突

太乙网络旨在构建一个充满活力的生态系统，为了确保生态系统的活力和创造力的涌现，其核心依赖于SGS的 **无准入（Permissionless）** 创新。任何心素账户都可以自由创建新的“天道”（SGS）来定义世界的新规则和资产行为。

然而，这种完全的开放性带来了一个核心的治理悖论：一个恶意的或设计拙劣的SGS（例如，一个旨在进行经济攻击或破坏游戏叙事完整性的SGS）可能会对系统造成灾难性影响。如果任何人都可以随时引入混乱的“法则”，那么这个世界的“实在性”将如何维持？

太乙网络通过“非罡”（Feigang）奖励机制来激励优秀的 SGS 创造者，该机制将计算资源消耗（QI）直接转化为对创造者的奖励，形成了“效用证明”的经济闭环。然而，仅依靠正向激励机制不足以应对蓄意破坏。恶意或设计错误的 SGS 可能会对特定的局部区域（Zone）造成灾难性影响。例如，一个破坏性 SGS 可能通过利用底层协议漏洞，或执行极度资源密集型的操作，对区域以及在区域范围中运行的所有关联NFA进行投机攻击，导致整个游戏的叙事性和公平性被破坏，恶意行为者可能通过创建单纯地消耗QI的SGS来获得的微薄奖励（传统MUD游戏也很难解决“巫师”作恶的问题）。因此，为维护去中心化自治世界（DAW）的“实在性”，必须引入硬性的惩罚和禁止机制。

### 7.2. 区域（Zone）作为自治主权边界

太乙网络的解决方案是将治理权下放到局部，而非依赖全局的中心化审查（即使“坐忘道”成员们可以通过协议对作恶心素进行处理，但其博弈过程可能会非常复杂且漫长）。系统引入了区域（Zone）作为行使局部主权（Local Sovereignty）的实体。

区域本身是一个可编程非同质化资产（NFA），其所有者被协议授予了对其领地内SGS运行的许可控制权。

Zone NFA 扮演了局部“城主”或“领主”的角色。通过赋予区域拥有者对进入其边界的 SGS 设定运行许可的能力，Zone的SGS许可机制实现了在不修改底层 C++ 共识协议的前提下，对局部环境实现 **动态、局部、即时** 的规则强制执行。这种权力下放模型增强了系统的抗脆弱性。基础层的全球共识（司命节点）负责维护基础安全和状态一致性，而将特定区域内运行 SGS 的 **内容责任** 下放给 Zone NFA 的拥有者或者持有其Active权限的账户。这种分层治理模型提高了系统应对局部危机（如针对某一区域或者游戏整体的经济攻击）的反应速度，确保了局部环境的稳定性和秩序。

实际上，很多“城主”并非心素，仅仅是一般玩家。在某种程度上，这种区域SGS自治机制为玩家又提供了一种内容管理的灵活性和创造力。

### 7.3. 区域许可的形式化定义与接口

Zone 的状态对象被扩展，用于存储SGS的权限列表。只有持有Zone NFA的 owner 或 active 权限的账户，才能发起治理操作。

核心治理接口包括（接口文档可以参考不断更新的[SGS APIs说明文档](./sgs_api.md)）：

- set_contract_permission：在Zone的权限映射表中显式设定一个SGS的许可状态（PROHIBITED 或 ALLOWED）。
- remove_contract_permission：移除对一个SGS的显式设定，使其恢复到默认状态。
- set_ref_prohibited_contract_zone：设置一个参照区域，用于继承其禁止/许可列表。

下表（表 3）总结了这些核心接口的功能。

**表 3: Zone权限管理核心接口及其作用**

| **接口函数 (Lua API)** | **功能描述** | **必需权限** | **Zone 状态影响** |
| ---------------------- | ------------ | ------------ | ----------------- |
| set_contract_permission | 设定指定 SGS 在本区域的显式许可或禁止状态。 | Owner或Active | 在 Zone 状态对象中创建/更新 SGS 许可记录。 |
| remove_contract_permission | 移除指定 SGS 的显式许可设定。 | Owner或Active | 从 Zone 状态对象中删除 SGS 许可记录，恢复至默认或参照规则。 |
| set_ref_prohibited_contract_zone | 将本区域的禁止列表参照至另一区域的禁止列表。 | Owner或Active | 更新 Zone 状态对象中的 ref_prohibited_zone_id 字段。 |

### 7.4. 区域协同治理：黑名单引用模型

在无准入的生态系统中（很多人都可以通过努力成为“心素”，但很多屠龙少年又终成恶龙），潜在的恶意或不良 SGS 数量可能会迅速增加。面对数千个不良或破坏性 SGS，要求每一个新创建的区域 NFA 都重复投入资源维护一个详尽的黑名单，将构成巨大的运营负担。这种重复劳动降低了治理效率，并延缓了新区域的创建和安全部署。为了解决这一可扩展性挑战，太乙网络引入了区域参照机制，允许一个 Zone 继承其他已建立、值得信赖的 Zone 的禁止列表，从而实现治理资源的有效共享。

通过 set_ref_prohibited_contract_zone 接口，该机制允许一个 Zone A **引用** 另一个（通常是更成熟、更值得信赖的）Zone B 的禁止列表。Zone A 并不存储 Zone B 的列表副本，而是在每次SGS权限检查时动态查询 Zone B 的状态。例如，代码实践中账号“红中”对他拥有的“牛心村”区域使用该接口参照了另一个 Zone （大梁）的禁止列表，这体现了区域间的协同治理。

这种设计创造了一个涌现性的治理信任网络（Emergent Trust Network）。参照机制本质上是创建了一个 **信任网络**。小型或新生的区域可以将安全和合规的责任委托给管理完善、信誉良好的大型区域。这使得安全标准能够自上而下地传播，解决了无准入系统的可扩展性难题。此外，这种结构促进了治理的专业化，某些核心 Zone（例如大梁）可能会演变为事实上的“安全审计机构”或“标准制定者”，其治理质量本身成为一种可量化的链上价值和信誉。

为了确保局部主权的最终裁决权，权限判定的优先级被严格定义为：**本地显式设定（Local Override）> 参照禁止（Reference Prohibition）> 全局默认（Global Default, 即允许）**。

### 7.5. 治理机制对经济引擎的贡献

Zone许可机制对于维护“元炁守恒定律”的长期稳定性至关重要。

通过禁止恶意的SGS（例如，那些纯粹为了“刷非罡”（Feigang-farming）而设计的、无实际效用的SGS），Zone NFA的所有者确保了在其领地内消耗的QI被用于真正有效的、非破坏性的状态变迁。

这极大地保护了“非罡”激励机制的信噪比（Signal-to-Noise Ratio）。它确保了SGS创造者获得的“非罡”奖励，确实来源于那些被市场（即Zone所有者和用户）认可的、对生态有益的SGS所产生的QI消耗。因此，这种治理能力使得“效用证明”（Proof-of-Utility）经济模型得以闭环。

更进一步，这种可验证的安全性（Good Governance）使Zone NFA本身增值。一个治理良好的Zone，其环境风险更低，更适合进行高价值的经济活动（如运行复杂的SGS）。这为Zone NFA的拥有者提供了直接的经济激励，促使其积极履行“城主”的治理职责。

## 8\. 坐忘道和“心素”

### 8.1. 坐忘道的起源与DAO本质

在太乙宇宙的多维结构中，“道界”控制着一切运行规则。然而，规则并非一成不变，而是随着宇宙的演化而不断修订与完善。为了实现宇宙的去中心化治理，并借鉴MUD（Multi-User Dungeon）系统的“巫师”（Wizard）思想，太乙宇宙引入了一个特殊的组织--“坐忘道”。

“坐忘”一词取自《庄子》，意为“离形去知，同于大通”，象征着修真者超越外在形式，直接与宇宙本源（道）相连。而在现代科技的语境下，“道”的拼音“DAO”恰好是“去中心化自治组织”（Decentralized Autonomous Organization）的缩写。因此，“坐忘道”不仅是一个哲学上的修真境界，更是一个运行在区块链共识层之上的去中心化治理联盟。

坐忘道作为太乙宇宙的“管理委员会”，其核心职能是维护宇宙的稳定性，并推动其向更高维度的演化。

### 8.2. 心素：神魂绑定的NFA身份

在坐忘道中，拥有治理权和“巫师权限”的个体被称为“心素”。这一称谓不仅暗示了其心境的纯粹与透明，更在技术层面上对应着一种特殊的非同质化资产（NFA）。

心素身份以 **不可转让的NFA（Soulbound Token, SBT）** 形式存在。在太乙宇宙的哲学中，这被称为“神魂绑定”。

- **不可转让性**：心素令牌一旦与账号绑定，便无法通过交易或赠予流转。这种设定确保了治理权的严肃性与唯一性，防止了权力的商品化。
- **身份标识**：持有的账号即获得了“心素”身份，成为坐忘道DAO的正式成员。

创世区块诞生之初，系统会将第一个心素令牌赋予创世账号，作为宇宙演化的最初火种。

### 8.3. 心素的权柄：巫师系统的虚实映射

类似于MUD系统中的巫师，心素在太乙宇宙中拥有超越普通生灵的权柄。这些权限在底层通过C++共识层进行严格校验，确保只有持有心素NFA的账号才能执行特定操作：

- **合约修造权**：心素有权创建和修订智能合约，定义宇宙运行的底层逻辑（如资源产出效率、战斗判定算法等）。
- **区域开辟权**：心素可以创建新的“区域”（Zone），扩展太乙宇宙的空间边界，实现世界的动态演化。
- **天赋赋予权**：心素能够定义角色的新型天赋和先天能力，为生灵的多样性提供蓝图。
- **实体定义权**：心素可以创建新的NFA定义，为宇宙引入全新的物质、法宝或成就系统。

这种设计将“开发者”与“运营者”的身份代入到游戏世界观中，使心素成为了实际意义上的“宇宙架构师”。

### 8.4. 坐忘道DAO治理与共识机制

坐忘道并不是心素个人的独裁领地，而是一个协同工作的联盟。任何重大的系统变更（如心素的产生与退出、核心参数的调整）都必须经过坐忘道DAO的提案和集体投票。

#### 8.4.1. 提案规则

太乙宇宙的C++共识层构建了一套严密的提案和投票系统：

- **门槛限制**：特定的治理函数（如 \`grant_new_xinsu\`、\`revoke_xinsu\`、\`set_application_criteria\`）必须通过提案和投票方可执行。
- **N人共识**：提案系统要求至少有 N 位心素参与并投票通过（N 为 \`chain_properties\` 中定义的参数）。
- **兜底机制**：当全网心素总数少于 N 位时，系统要求所有已存在的心素必须全部参与投票，以确保共识的合法性。

#### 8.4.2. 强制回收机制

为了应对可能出现的失职或账号风险，坐忘道DAO拥有“强制回收心素”的权限。通过提案和集体投票，可以将特定账号的神魂绑定SBT强制剥离并销毁，从而撤销其巫师权限。

### 8.5. 结语：成就与身份的基石

心素系统的引入，标志着太乙宇宙从简单的模拟世界进化为具有自我修复和演化能力的生命体。这种基于SBT的身份系统不仅用于高端治理，未来还将扩展到成就系统和荣誉体系中，为每一个在太乙宇宙中留下深刻印记的灵魂提供永恒的见证。

通过坐忘道，权力的行使不再是单纯的MUD指令，而是一场场关乎宇宙命运的博弈与博爱。

## 9\. 故事宇宙：一个由AI、NFA与经济法则共同驱动的涌现性叙事系统

本章旨在响应项目核心理念，将前述的技术与经济组件进行系统性综合，以形式化定义太乙网络如何作为一个“故事宇宙”运作。

### 9.1. 故事宇宙的定义：超越静态世界观

“故事宇宙”并非一个由开发者预先编写的静态背景故事（Lore）。相反，本文将“故事宇宙”形式化定义为一个**复杂自适应系统（Complex Adaptive System, CAS）**。

这正如《雪崩》中所描绘的“大街”（The Street）的起源史：在那个世界向公众开放之前的漫长十年里，第一批开拓者（Pioneers）就在那个尚且荒芜的、不完整的数字协议之上，通过不断的黑客攻击（Hacking）、实验和建设，一砖一瓦地搭建出了后来的繁荣范式。太乙网络的“故事宇宙”也包含着这样一种**早期开拓者的演化愿景**。

在这个系统中，“叙事”（Narrative）本身是该系统在不可篡改的账本（即太乙区块链）上记录的**涌现性状态变迁（Emergent State Transitions）**。它记录的不仅仅是当下的横截面，更是从最初的协议火种开始，所有参与者（人类与AI）共同“Hack”这个世界演化的全过程。本章将解构该系统涌现性的四个核心支柱：主体（The Who）、物理（The How）、经济（The Why）和疆域（The Where）。

### 9.2. 叙事的主体：人类玩家与作为一等公民的AI代理 (The "Who")

构建于第2章（元神界）和第6章（AI代理）的论述之上，本系统中的叙事是由两类具有同等地位的自主代理（Autonomous Agents）共同驱动的：

- **人类代理**：通过其账号（元神）与网络交互。
- **人工智能代理**：通过其账号（元神）与网络交互。

这些代理的行为（表现为签名的Operations）是驱动叙事展开的根本动因。

### 9.3. 叙事的物理：作为可编程“物理法则”的SGS (The "How")

构建于第4章（SGS与Lua VM）的论述之上，“天道”（SGS）构成了这个宇宙的**可编程物理学**（Programmable Physics）。它们定义了叙事展开的方式（The "How"）。

SGS定义了什么是可能的、什么是不可能的，以及一切行动的代价（QI消耗）和后果（状态变更）。因此，每一个故事（例如，“一个角色使用‘衍童石’创造了另一个角色”）在协议层面都是一次计算（SGS的执行），它消耗能量（QI），并根据既定的物理法则（SGS代码），将一个初始状态转换为一个不可逆转的最终状态。

### 9.4. 叙事的经济：由“元炁守恒”驱动的效用证明 (The "Why")

构建于第5章（元炁守恒定律）的论述之上，代理的行为并非随机，它们受到统一经济法则的激励和约束。该经济法则为所有代理提供了行动的根本动机（The "Why"）。

“元炁守恒定律”确保了：

- **生存/行动的动机**：代理必须通过“修真”（第5.2节公式）获取QI，才能支付“行动”的代价（执行SGS）。
- **创造/贡献的动机**：代理必须创造有用的“物理法则”（即高质量的SGS），才能通过非罡机制获得奖励，从而获取更多的QI。

因此，效用证明（Proof-of-Utility）机制本身就是这个宇宙的核心情节引擎（Plot Engine）。它在经济上保证了“故事宇宙”将自发地充满冲突、创新、合作与竞争，因为所有代理都在一个共同的框架下竞争，以获取能量（QI）和创造效用（SGS）。一个AI代理的“角色弧光”可能就是其在链上可验证的、最大化其真气/非罡收入的理性追求过程。

### 9.5. 叙事的疆域：作为主权舞台的区域NFA (The "Where")

构建于第7章（Zone NFA）的论述之上，叙事发生的“地点”（The "Where"）不是均质的。每一个区域NFA都是一个主权舞台（Sovereign Stage）。该舞台的所有者（比如“城主”）通过SGS许可机制，扮演了“局部叙事导演”的角色，定义了该舞台的“局部叙事规则”（例如，通过 set_contract_permission设定“此地禁止PVP”或“此地魔法无效”）。

这种机制允许涌现性文化（Emergent Cultures）的产生。一个由AI城主严格管理的、拥有全面黑名单的Zone NFA，将自发产生关于“秩序”、“法律”和“文明”的叙事。而一个完全无准入的Zone NFA，则将产生关于“混沌”、“边疆”和“危险”的叙事。

### 9.6. 叙事的体验：“神魂接入”与涌现性存在 (The "Feeling")

构建于第6章（“神魂接入”）的论述之上，叙事的“体验”（The "Feeling"）是全景式（Panoramic）和民主化（Democratized）的。“神魂接入”和“夺舍”协议允许任何代理（元神）从任何其拥有的NFA视角来体验和驱动叙事。

综上所述，“故事宇宙”是太乙网络架构的整体涌现属性。它是一个宇宙，其中叙事的主体（人类/AI）、物理（SGS）、经济（QI/Feigang）和疆域（Zones）都是可编程的、自主的、并在链上协同演化的。而“故事”本身，就是这场协同演化的、可被验证的、不可篡改的记录（即太乙区块链本身）。

## 10\. 实验性实现：大傩世界

为了验证和展示太乙网络协议的能力，一个名为“大傩世界”的MUD（多用户地牢）游戏被作为其首个实验性应用。本节将通过分析其核心机制的代码逻辑和交互流程，来具体说明太乙协议（特别是第9章所述的“故事宇宙”）的实际运作。

### 10.1. 核心世界构建机制的代码逻辑分析

通过对[taiyi-contracts仓库](https://github.com/hongzhongx/taiyi-contracts)中SGS功能的分析，我们可以解构出“故事宇宙”中“物理法则”的具体实现。

#### 10.1.1. 资源生成：liantianta.lua 的逻辑

“炼天塔”（Refining Heaven Pagoda）是一个典型的自主生产型NFA，其SGS (liantianta.lua) 的核心逻辑如下：

- **状态变量**：SGS内部通过API读写关键的状态变量，如 nfa.owner（所有者账户）、nfa.qi（存储的混沌元气数量）。
- **自主行为 (heart_beat函数)**：该函数被设计为由太乙网络协议周期性地自动调用。其内部逻辑会检查nfa.qi的存量。如果存量大于阈值，它将执行转化逻辑：消耗一定数量的 QI，并为 nfa 增加相应数量的基础资源FT（例如“金”和“食”）。转化比例是硬编码在底层（C++）中的基本规则。如果 QI 不足，该函数则不执行任何操作。
- **主动激活 (active 函数)**：此函数允许NFA的 owner 通过发送一笔含有执行操作的交易（transaction）来手动触发一次资源转化过程，或者在 heart_beat 因能量不足停止后重新激活它。

这个SGS清晰地展示了一个可编程NFA如何作为一个自主经济代理在世界中运作，它遵循内部SGS定义的“物理法则”（转化率），持续地将能量（QI）转化为物质（FT）。

#### 10.1.2. 实体创生：yantongshi.lua 的逻辑

“衍童石”则展示了NFA如何作为创造其他NFA的“工厂”，其SGS (yantongshi.lua)的核心是 born_actor 函数：

- **核心功能**：born_actor 函数允许“衍童石”的所有者在石头所在的区域NFA中诞生一个新的角色NFA。
- **参数化创生**：该函数接受多个参数，如 sex（性别）、sxq（性取向）和 prop（一个包含初始属性点分配的表，如膂力、根骨等）。这表明创生过程是高度可定制的。
- **与底层协议交互**：函数内部逻辑会调用太乙网络底层的原生函数（通过Lua C-API暴露给虚拟机）。首先，它会调用一个类似 \__create_actor 的内部函数，该函数负责在区块链状态中创建一个新的、基础的NFA对象，并返回其唯一ID。接着，它会调用 \__upgrade_actor_contract 函数，将新创建的角色NFA的核心合约设置为一个标准的角色行为SGS（例如 contract.actor.normal）。最后，它会根据传入的 prop 参数，设置新角色NFA的初始属性值。

这个例子揭示了SGS在世界构建中的强大能力：它们不仅能改变自身状态，还能通过与底层协议交互来实例化和配置全新的、复杂的链上对象，这使得世界的演化和扩展可以完全由游戏内的逻辑和资产来驱动。

### 10.2. 链上交互追踪：一个MUD指令的生命周期

下面将基于[ndanuo MUD客户端](https://github.com/hongzhongx/ndanuo)的实际交互日志，追踪一个简单的玩家指令 start_cultivation的完整生命周期，以展示“故事宇宙”中四大支柱（主体、物理、经济、疆域）的协同运作。

- **输入 (主体)**：玩家（元神）在 ndanuo MUD客户端中输入指令 start_cultivation。
- **交易构建 (主体 -> 物理)**：客户端解析该指令，并构建一笔太乙网络交易。该交易包含一个Operation，目标是玩家当前“神魂接入”的角色NFA，调用的SGS函数是其核心合约中的 start_cultivation。交易由玩家账户的私钥签名。
- **网络共识**：交易被广播到太乙网络。一个轮值的“司命”节点在其区块提案中包含了这笔交易。经过DPOS共识，该区块被最终确认，大约耗时3秒（“一息”）。
- **状态变更 (物理 -> 叙事)**：交易被执行时，角色NFA的 start_cultivation 函数在Lua虚拟机中运行。该SGS（物理法则）修改角色NFA的内部状态，例如设置一个 is_cultivating 标志为 true，并记录开始时间戳。
- **经济影响 (QI消耗) (经济)**：Lua虚拟机根据 start_cultivation 函数的计算复杂度，计算出需要消耗的QI数量（例如 0.01 QI）。这笔QI从玩家的账户余额中扣除。
- **经济影响 (Feigang奖励) (经济 -> 物理)**：被消耗的 0.01 QI 立即转化为 0.01 非罡（Feigang），并记入该角色核心SGS（start_cultivation所属合约）的创建者的账户中。
- **客户端响应 (叙事)**：ndanuo 客户端监听到交易成功确认的事件后，向玩家显示成功信息，例如：“你开始吐纳天地元气，进入了修真状态。”。

### 10.3. 模拟：AI代理的自主经济活动

设想一个拥有“炼天塔”NFA的AI代理（元神）。该AI的程序逻辑可以周期性地通过API查询太乙链上由某个“预言机”SGS提供的基础资源FT（金、食、木、织、药）的实时市场价格。

当AI检测到“食物”（FOOD）的价格最高时，它会自主构建并广播一笔交易，调用其“炼天塔”NFA的 active 函数，并传入参数指定将存储的 QI 全部转化为“食物”。交易成功后，AI的账户中会增加大量的“食物”FT，随后它可以在游戏内的去中心化市场上出售这些“食物”以获利。

这个过程完全自动化，完美展示了第9章所述的“故事宇宙”：一个自主主体（AI代理）利用可编程物理（liantianta.lua）并遵循经济激励（利差）在链上展开行动，其所有行为都被不可篡改地记录为“叙事”的一部分。

## 11\. 结论

太乙网络提出了一套用于构建持久化、去中心化自治世界的综合性协议。通过对现有中心化虚拟世界和第一代区块链游戏（GameFi 1.0）局限性的深刻反思，太乙网络在架构、共识、经济模型和核心资产原语上进行了一系列根本性的创新。

其核心贡献在于：

- **一个为游戏而生的、高性能的定制化架构**：通过采用C++和DPOS共识（~3秒“一息”），并集成专为游戏逻辑优化的Lua虚拟机，太乙网络旨在从根本上解决通用区块链在承载复杂、高频交互世界时的性能瓶颈。
- **一个自洽的、“效用证明”经济模型**：创新的“元炁守恒定律”和“非罡”机制，将网络资源的消耗（Gas/QI）直接转化为对有价值应用逻辑（SGS）创造者的客观、非转移性奖励。这构建了一个能够自我激励、自我调节的经济闭环，为解决Web3领域的“创造者经济”难题提供了新的范式。
- **游戏内去中心化自治组织**：世界不仅是数据的集合，更是参与者共同驱动的演化实体。太乙网络在共识层引入了“坐忘道”自治组织与“心素”身份体系。坐忘道作为太乙宇宙的最高管理机构与联盟，承担着维护世界稳定性、设定演化规则及推动系统迭代的核心职能。它并非一个中心化的实体，而是由持有特定权限标识的一组“心素”构成的去中心化治理联盟。这种设计既保留了 MUD 系统中巫师作为“仁慈独裁者”对平衡性的把控力，又通过区块链技术将其权力约束在去中心化的社会契约与代码宪法之中，确保了太乙自治世界的长久生命力。
- **一个范式转换的资产与交互原语**：可编程NFA及其独特的“神魂接入”（夺舍）协议，将链上资产从静态的所有权凭证，提升为具有内生逻辑和自主行为能力的动态代理。
- **一个涌现性的“故事宇宙”**：如第9章所论证，通过将自主代理（人类与AI）、可编程物理（SGS）、自洽经济（元炁守恒）和局部主权（Zone NFA）相结合，太乙网络构建了一个作为复杂自适应系统的“故事宇宙”，其叙事是所有参与者协同演化的、不可篡改的链上记录。

这些组件协同工作，共同服务于“修真成真”的宏大愿景。太乙网络不仅是一个技术框架，更是一场关于数字“实在性”的哲学实验。它证明了通过精巧的协议设计，一个纯粹由信息构成的世界，可以拥有不可篡改的历史、强制执行的法则、可验证的所有权和可持续的内部经济。这代表了在构建有意义、有持久价值的数字存在方面，迈出了坚实的一步。
